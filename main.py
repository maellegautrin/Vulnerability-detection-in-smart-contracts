import os
import subprocess
import sys

def run_graph_treatment(dot_file):
    command = f"python3 graph_treatment.py {dot_file}"
    subprocess.run(command, shell=True, check=True)

def run_graph2vec(input_folder, output_file):
    os.chdir("graph2vec-master")
    command = f"python3 src/graph2vec.py --input-path {input_folder} --output-path {output_file}"
    subprocess.run(command, shell=True, check=True)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <dot_file>")
        sys.exit(1)

    dot_file = sys.argv[1]

    # Vérifier si le fichier .dot existe
    if not os.path.isfile(dot_file):
        print(f"Error: File '{dot_file}' not found.")
        sys.exit(1)
    
    # Exécuter graph_treatment.py avec le fichier .dot en argument
    run_graph_treatment(dot_file)
    
    # Extraire le nom de fichier sans extension
    filename = os.path.splitext(os.path.basename(dot_file))[0]
    # Chemin vers le dossier contenant les fichiers .json
    input_folder = f"../subgraphs/{filename}/"
    # Chemin vers le fichier de sortie CSV
    output_file = "../dataset_vector/"+filename+".csv"
    
    # Exécuter graph2vec.py
    run_graph2vec(input_folder, output_file)
